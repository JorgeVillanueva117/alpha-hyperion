<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alpha Hyperion â€” Chat</title>
  <meta name="description" content="Alpha Hyperion AI â€” Interfaz de chat. Frontend minimalista para conectar con tu router/API de Alpha Hyperion." />
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1724; --muted:#98a0b3; --accent:#4f46e5; --accent-2:#06b6d4; --card:#0b1220; --success:#10b981;
      --glass: rgba(255,255,255,0.03);
      --shadow: 0 6px 18px rgba(2,6,23,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#05060a 0%, #071028 60%);color:#e6eef8}
    .app{display:grid;grid-template-columns:320px 1fr;gap:20px;padding:20px;height:100vh}

    /* Sidebar */
    .sidebar{background:var(--panel);border-radius:12px;padding:14px;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .logo{font-weight:700;font-size:18px;margin-bottom:8px;display:flex;gap:10px;align-items:center}
    .logo .dot{width:12px;height:12px;border-radius:4px;background:linear-gradient(135deg,var(--accent),var(--accent-2))}
    .models{margin-top:10px;flex:1;overflow:auto;padding-right:6px}
    .model{background:var(--glass);padding:10px;border-radius:8px;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .model.active{outline:2px solid rgba(79,70,229,0.12);box-shadow:inset 0 -2px 0 rgba(255,255,255,0.02)}
    .small{font-size:12px;color:var(--muted)}
    .controls{margin-top:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03);cursor:pointer}

    /* Main */
    .main{display:flex;flex-direction:column;gap:12px}
    .header{display:flex;align-items:center;justify-content:space-between;padding:12px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);border-radius:12px}
    .title{font-size:16px;font-weight:700}
    .settings{display:flex;gap:8px;align-items:center}
    .chip{background:var(--card);padding:8px;border-radius:999px;font-size:13px;color:var(--muted);border:1px solid rgba(255,255,255,0.02)}

    .chat{flex:1;overflow:auto;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));box-shadow:var(--shadow)}
    .msg{display:flex;gap:12px;margin-bottom:14px}
    .avatar{width:40px;height:40px;border-radius:8px;flex:0 0 40px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700}
    .bubble{padding:12px;border-radius:12px;max-width:78%;line-height:1.4}
    .bubble.user{background:linear-gradient(90deg, rgba(79,70,229,0.16), rgba(6,182,212,0.06));align-self:flex-end}
    .bubble.bot{background:rgba(255,255,255,0.03)}
    .meta{font-size:12px;color:var(--muted);margin-top:6px}

    .composer{display:flex;gap:8px;padding:12px;background:linear-gradient(90deg, rgba(255,255,255,0.01), transparent);border-radius:12px;align-items:center}
    textarea{flex:1;min-height:48px;max-height:240px;border-radius:8px;padding:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;font-size:14px}
    .send{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:10px 14px;border-radius:10px;border:none;color:white;cursor:pointer}

    .footer{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;margin-top:6px}
    .setting-row{display:flex;gap:8px;align-items:center}

    /* responsive */
    @media(max-width:900px){.app{grid-template-columns:1fr;}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <aside class="sidebar" aria-label="Panel de modelos">
      <div class="logo"><span class="dot"></span><div>Alpha Hyperion <span class="small">v3</span></div></div>
      <div class="small">Expert Mesh â€” Selecciona un experto para probar</div>
      <div class="models" id="modelList" role="list">
        <!-- Models injected by JS -->
      </div>
      <div class="controls">
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <button class="btn" id="newConv">+ Nueva conversaciÃ³n</button>
          <button class="btn" id="clearCache">ðŸ§¹ Limpiar cache</button>
        </div>
        <div class="small" style="margin-top:8px">Router: <strong id="routerStatus">activo</strong></div>
      </div>
    </aside>

    <main class="main">
      <header class="header">
        <div>
          <div class="title">Alpha Hyperion â€” Chat</div>
          <div class="small">Conecta tu frontend a <code>/api/chat</code> (router) â€” configuraciones abajo.</div>
        </div>
        <div class="settings">
          <div class="chip" id="selectedModel">Modelo: â€”</div>
          <div class="chip">Contexto: <span id="contextSize">128k</span></div>
          <div class="chip">Modo: <select id="modeSelect" style="background:transparent;border:none;color:inherit">
            <option>ConversaciÃ³n</option><option>Resumen</option><option>Code-run</option>
          </select></div>
        </div>
      </header>

      <section class="chat" id="chatArea" aria-live="polite" tabindex="0">
        <!-- messages -->
      </section>

      <div class="composer" role="form" aria-label="Compositor de mensajes">
        <textarea id="input" placeholder="Escribe tu mensaje... (Shift+Enter para nueva lÃ­nea)"></textarea>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div class="small">Temp: <input id="temp" type="range" min="0" max="1" step="0.05" value="0.2"></div>
          <button class="send" id="sendBtn">Enviar</button>
        </div>
      </div>
      <div class="footer">
        <div class="setting-row">Tokens estimados: <strong id="tokenEstimate">â€”</strong></div>
        <div class="setting-row"><small class="small">Alpha Hyperion â€¢ Local</small></div>
      </div>
    </main>
  </div>

  <script>
    // ========== Configuracion inicial ==========
    const MODELS = [
      { id:'alpha-math-7b', name:'AlphaMath-7B', ctx:'8k', role:'MatemÃ¡ticas'},
      { id:'alpha-code-13b', name:'AlphaCode-13B', ctx:'32k', role:'CÃ³digo'},
      { id:'alpha-vision-8b', name:'AlphaVision-8B', ctx:'32k', role:'VisiÃ³n'},
      { id:'alpha-reason-34b', name:'AlphaReason-34B', ctx:'128k', role:'Razonamiento'},
      { id:'alpha-agent-70b', name:'AlphaAgent-70B', ctx:'128k', role:'Agente'},
      { id:'alpha-lang-13b', name:'AlphaLang-13B', ctx:'32k', role:'MultilingÃ¼e'},
      { id:'alpha-med-7b', name:'AlphaMed-7B', ctx:'8k', role:'Salud'},
      { id:'alpha-law-13b', name:'AlphaLaw-13B', ctx:'32k', role:'Legal'},
      { id:'alpha-finance-34b', name:'AlphaFinance-34B', ctx:'128k', role:'Finanzas'},
      { id:'alpha-game-70b', name:'AlphaGame-70B', ctx:'128k', role:'Juegos'}
    ];

    const apiEndpoint = '/api/chat'; // Cambia por tu endpoint del router

    // ========== UI helpers ==========
    const modelList = document.getElementById('modelList');
    const selectedModelLabel = document.getElementById('selectedModel');
    const contextSizeLabel = document.getElementById('contextSize');
    const chatArea = document.getElementById('chatArea');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const temp = document.getElementById('temp');
    const tokenEstimate = document.getElementById('tokenEstimate');

    let activeModel = MODELS[3]; // por defecto AlphaReason
    let conversation = [];

    function renderModels(){
      modelList.innerHTML = '';
      MODELS.forEach(m => {
        const el = document.createElement('div');
        el.className = 'model' + (m.id===activeModel.id?' active':'');
        el.setAttribute('role','button');
        el.innerHTML = `<div style="display:flex;flex-direction:column"><strong>${m.name}</strong><span class='small'>${m.role} â€¢ ${m.ctx}</span></div><div class='small'>${m.ctx}</div>`;
        el.onclick = ()=>{ activeModel = m; updateSelected(); renderModels(); };
        modelList.appendChild(el);
      });
      updateSelected();
    }

    function updateSelected(){
      selectedModelLabel.textContent = 'Modelo: ' + activeModel.name;
      contextSizeLabel.textContent = activeModel.ctx;
    }

    function appendMessage(who, text){
      const div = document.createElement('div'); div.className='msg';
      const avatar = document.createElement('div'); avatar.className='avatar'; avatar.textContent = who==='user' ? 'U' : 'AH';
      const bubble = document.createElement('div'); bubble.className='bubble ' + (who==='user' ? 'user':'bot');
      bubble.innerHTML = text.replace(/\n/g,'<br>');
      const meta = document.createElement('div'); meta.className='meta'; meta.textContent = who==='user' ? 'Usuario' : activeModel.name;
      const col = document.createElement('div'); col.style.flex='1'; col.appendChild(bubble); col.appendChild(meta);
      div.appendChild(avatar); div.appendChild(col);
      chatArea.appendChild(div);
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    function estimateTokens(text){
      // estimacion brutal: 4 chars ~ 1 token
      const approx = Math.ceil(text.length / 4);
      tokenEstimate.textContent = approx + ' tokens (estim)';
      return approx;
    }

    // ========== Send logic (calls /api/chat) ==========
    async function send(){
      const content = input.value.trim();
      if(!content) return;
      appendMessage('user', content);
      estimateTokens(content);
      input.value='';

      // show a temporary assistant bubble
      const loadingId = 'loading-'+Date.now();
      appendMessage('bot', 'â€¦ generando respuesta â€” contactando al router');

      // Build payload
      const payload = {
        model: activeModel.id,
        temperature: parseFloat(temp.value),
        prompt: content,
        context_limit: activeModel.ctx,
        metadata: {source:'web-ui'}
      };

      try{
        const t0 = performance.now();
        const res = await fetch(apiEndpoint, {
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
        });
        const t1 = performance.now();
        if(!res.ok){
          const err = await res.text();
          appendMessage('bot', 'Error del servidor: ' + err);
          return;
        }
        const body = await res.json();
        // Expected: { reply: string, tokens: {input: N, output: M}, model_used: 'alpha-reason-34b' }
        const reply = body.reply || ('(sin respuesta)');
        appendMessage('bot', reply + `\n\nâ€” (modelo usado: ${body.model_used || 'desconocido'})\nTiempo: ${(t1-t0).toFixed(0)} ms`);
      }catch(e){
        appendMessage('bot', 'ExcepciÃ³n: ' + e.message);
      }
    }

    // keyboard
    input.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
    });
    sendBtn.addEventListener('click', send);

    // quick actions
    document.getElementById('newConv').addEventListener('click', ()=>{ conversation=[]; chatArea.innerHTML=''; appendMessage('bot','Bienvenido a Alpha Hyperion. Selecciona un experto y pregunta.'); });
    document.getElementById('clearCache').addEventListener('click', ()=>{ localStorage.clear(); alert('Cache local limpiado'); });

    // init
    renderModels();
    appendMessage('bot','Bienvenido a Alpha Hyperion. Selecciona un experto y haz tu primera pregunta.');

    // Accessibility focus
    chatArea.focus();
  </script>
</body>
</html>

